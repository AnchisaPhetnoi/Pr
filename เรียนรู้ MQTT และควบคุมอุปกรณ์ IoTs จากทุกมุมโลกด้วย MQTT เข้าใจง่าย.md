# เรียนรู้ MQTT และควบคุมอุปกรณ์ IoTs จากทุกมุมโลกด้วย MQTT เข้าใจง่าย

![ภาพ](https://github.com/user-attachments/assets/d013eeb0-9960-44fd-90c3-9e11d150f529)



## MQTT คืออะไร: คำอธิบายง่ายๆ สำหรับทุกคน

    MQTT (Message Queuing Telemetry Transport) เป็นโปรโตคอลที่ออกแบบมาเพื่อการสื่อสารแบบง่ายๆ และมีประสิทธิภาพสูง 
ระหว่างอุปกรณ์ต่างๆ เช่น เซ็นเซอร์, อุปกรณ์ IoT, และแอปพลิเคชัน โดยเฉพาะอย่างยิ่งในสภาพแวดล้อมที่มีการเชื่อมต่อแบบจำกัด หรือต้องการส่งข้อมูลแบบเรียลไทม์

## ทำไมต้อง MQTT?

    ง่ายต่อการใช้งาน: โครงสร้างของ MQTT นั้นเรียบง่าย ทำให้การพัฒนาและใช้งานโปรแกรมที่ใช้ MQTT นั้นง่ายกว่าโปรโตคอลอื่นๆ
    เหมาะสำหรับ IoT: MQTT ถูกออกแบบมาเพื่อใช้งานกับอุปกรณ์ IoT ซึ่งมักมีทรัพยากรจำกัด ทั้งในแง่ของพลังงาน และการประมวลผล
    ประสิทธิภาพสูง: MQTT สามารถส่งข้อมูลได้อย่างรวดเร็วและเชื่อถือได้ แม้ในสภาพแวดล้อมที่มีการเชื่อมต่อแบบไม่เสถียร
    แบบจำลองการเผยแพร่-สมัครรับ: MQTT ใช้แบบจำลองการเผยแพร่-สมัครรับ (publish-subscribe) ซึ่งทำให้การสื่อสารระหว่างอุปกรณ์ต่างๆ เป็นไปอย่างอิสระ

## MQTT ทำงานอย่างไร?

    Broker: เป็นตัวกลางในการรับส่งข้อความ ระหว่างอุปกรณ์ที่ต้องการส่งข้อมูล (publisher) และอุปกรณ์ที่ต้องการรับข้อมูล (subscriber)
    Topic: เป็นหัวข้อหรือช่องทางในการส่งข้อมูล ผู้เผยแพร่จะส่งข้อความไปยังหัวข้อหนึ่งๆ และผู้สมัครรับที่สนใจหัวข้อนั้นก็จะได้รับข้อความ
    Publisher: อุปกรณ์ที่ส่งข้อความไปยัง Broker
    Subscriber: อุปกรณ์ที่รับข้อความจาก Broker

## ตัวอย่าง:

    เซ็นเซอร์วัดอุณหภูมิ (publisher) ส่งข้อมูลอุณหภูมิไปยังหัวข้อ "temperature"
    แอปพลิเคชันบนมือถือ (subscriber) สมัครรับข้อมูลจากหัวข้อ "temperature" เพื่อแสดงผลบนหน้าจอ

## เหตุผลที่ MQTT เป็นที่นิยม

    IoT: ใช้ในการเชื่อมต่อเซ็นเซอร์, อุปกรณ์ควบคุมต่างๆ ในบ้านอัจฉริยะ, อุตสาหกรรม, และเมืองอัจฉริยะ
    ระบบควบคุมระยะไกล: ใช้ในการควบคุมอุปกรณ์ต่างๆ จากระยะไกล เช่น การควบคุมเครื่องปรับอากาศ, ไฟส่องสว่าง
    การเก็บข้อมูล: ใช้ในการเก็บรวบรวมข้อมูลจากอุปกรณ์ต่างๆ เพื่อนำไปวิเคราะห์

## สรุป

## MQTT เป็นโปรโตคอลที่ทรงพลังและมีความยืดหยุ่น เหมาะสำหรับการใช้งานในหลากหลายรูปแบบ โดยเฉพาะอย่างยิ่งในด้าน IoT และระบบที่ต้องการการสื่อสารแบบเรียลไทม์ หากคุณกำลังพัฒนาระบบที่เกี่ยวข้องกับการเชื่อมต่ออุปกรณ์ต่างๆ MQTT อาจเป็นตัวเลือกที่น่าสนใจ




## การนำ MQTT ไปใช้กับเซ็นเซอร์วัดอุณหภูมิและแอปมือถือ: กระบวนการทำงานโดยละเอียด

## เข้าใจภาพรวมก่อน

## การนำ MQTT มาใช้ในการส่งข้อมูลจากเซ็นเซอร์วัดอุณหภูมิไปยังแอปมือถือเป็นการประยุกต์ใช้ที่ค่อนข้างพื้นฐานและเป็นที่นิยมในระบบ IoT (Internet of Things) โดยมีกระบวนการหลักดังนี้:

    เซ็นเซอร์วัดอุณหภูมิ (Publisher): เก็บข้อมูลอุณหภูมิและส่งข้อมูลนั้นไปยังหัวข้อ "temperature" บน MQTT Broker
    MQTT Broker: ทำหน้าที่เป็นตัวกลางในการรับส่งข้อมูล โดยเก็บข้อความที่ถูกส่งมาจาก Publisher ไว้ และเมื่อมี Subscriber มาขอรับข้อมูลที่หัวข้อ "temperature" ก็จะส่งข้อมูลนั้นไปให้
    แอปมือถือ (Subscriber): สมัครรับข้อมูลจากหัวข้อ "temperature" บน MQTT Broker และเมื่อได้รับข้อมูลมาแล้ว ก็จะนำข้อมูลนั้นมาแสดงบนหน้าจอ

## กระบวนการทำงานโดยละเอียด

    การติดตั้งเซ็นเซอร์และการเชื่อมต่อกับ MQTT Broker:
        เลือกเซ็นเซอร์: เลือกเซ็นเซอร์วัดอุณหภูมิที่เหมาะสมกับความต้องการ เช่น เซ็นเซอร์ DHT11, DS18B20 เป็นต้น
        เลือกบอร์ดไมโครคอนโทรลเลอร์: เลือกบอร์ดที่รองรับการทำงานกับเซ็นเซอร์และมีไลบารี MQTT เช่น Arduino, Raspberry Pi
        ติดตั้งไลบารี MQTT: ติดตั้งไลบารี MQTT บนบอร์ดไมโครคอนโทรลเลอร์ที่เลือก
        กำหนดค่า: กำหนดค่าการเชื่อมต่อกับ MQTT Broker เช่น IP Address, Port, Username, Password
        เขียนโค้ด: เขียนโค้ดเพื่อให้บอร์ดสามารถอ่านค่าจากเซ็นเซอร์และส่งข้อมูลไปยัง MQTT Broker บนหัวข้อ "temperature" ในรูปแบบที่กำหนด

    การสร้าง MQTT Broker:
        เลือก MQTT Broker: เลือก MQTT Broker ที่เหมาะสม เช่น Mosquitto, HiveMQ, EMQX
        ติดตั้งและตั้งค่า: ติดตั้งและตั้งค่า MQTT Broker ตามคู่มือ
        สร้างหัวข้อ: สร้างหัวข้อ "temperature" บน MQTT Broker

    การพัฒนาแอปพลิเคชันมือถือ:
        เลือกแพลตฟอร์ม: เลือกแพลตฟอร์มในการพัฒนาแอป เช่น Android, iOS
        เลือกไลบารี MQTT: เลือกไลบารี MQTT สำหรับแพลตฟอร์มที่เลือก เช่น Paho MQTT
        เขียนโค้ด: เขียนโค้ดเพื่อให้แอปสามารถเชื่อมต่อกับ MQTT Broker และสมัครรับข้อมูลจากหัวข้อ "temperature" เมื่อได้รับข้อมูลมาแล้ว ก็จะนำมาแสดงบนหน้าจอ



### ตัวอย่างโค้ด (Arduino + MQTT): C++
```cmd

#include <ESP8266WiFi.h>
#include <PubSubClient.h>

// ... (ข้อมูลการเชื่อมต่อ WiFi และ MQTT Broker)

void setup() {
  // ... (เริ่มต้น WiFi และ MQTT)
}

void loop() {
  // อ่านค่าจากเซ็นเซอร์
  float temperature = readTemperature();

  // สร้างข้อความที่จะส่ง
  String payload = String(temperature) + " C";

  // ส่งข้อความไปยัง MQTT Broker
  client.publish("temperature", payload.c_str());
  
  delay(5000);
}


```

### ตัวอย่างโค้ด (Android + MQTT):
```cmd
Java

// ... (import library)

public class MainActivity extends AppCompatActivity {
  // ... (ตัวแปรสำหรับ MQTT Client)

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    // ... (เชื่อมต่อกับ MQTT Broker และสมัครรับข้อมูล)
  }

  // Callback เมื่อได้รับข้อมูล
  public void messageArrived(String topic, byte[] message) {
    String temp = new String(message);
    textView.setText("Temperature: " + temp);
  }
}

```


##  สิ่งที่ต้องพิจารณาเพิ่มเติม:

    ความปลอดภัย: ควรใช้การเข้ารหัสในการสื่อสารระหว่างอุปกรณ์และ MQTT Broker เพื่อป้องกันการเข้าถึงข้อมูลโดยไม่ได้รับอนุญาต
    คุณภาพของ Service: เลือก MQTT Broker ที่มีคุณภาพและมีความเสถียรสูง
    การจัดการข้อผิดพลาด: ควรเขียนโค้ดเพื่อจัดการกับสถานการณ์ที่เกิดข้อผิดพลาด เช่น การเชื่อมต่อขาดหาย
    การปรับแต่ง: สามารถปรับแต่งระบบให้มีความซับซ้อนมากขึ้น เช่น เพิ่มการส่งข้อมูลหลายหัวข้อ, การเก็บข้อมูลในฐานข้อมูล, การสร้างกราฟแสดงข้อมูล

##  สรุป

การนำ MQTT มาใช้ในการส่งข้อมูลจากเซ็นเซอร์วัดอุณหภูมิไปยังแอปมือถือเป็นการเริ่มต้นที่ดีในการเรียนรู้และพัฒนาระบบ IoT โดยมีขั้นตอนที่ค่อนข้างชัดเจนและสามารถนำไปประยุกต์ใช้กับเซ็นเซอร์ชนิดอื่นๆ และแอปพลิเคชันอื่นๆ ได้อีกมากมาย




![ภาพ](https://github.com/user-attachments/assets/925a8902-addc-46d2-ae42-18ef09626227)

![ภาพ](https://github.com/user-attachments/assets/c67a8ad6-bd9a-4d4d-aeea-cd4c6c2aa4ac)

![ภาพ](https://github.com/user-attachments/assets/a65056d6-c2a2-453d-9c4b-50118450392a)

![ภาพ](https://github.com/user-attachments/assets/41dc2ca4-dafb-42b9-b405-49c16ffd9fbb)

![ภาพ](https://github.com/user-attachments/assets/95009661-4016-4c38-b810-9adbd7ea9540)

![ภาพ](https://github.com/user-attachments/assets/7674230b-dde9-483c-ba32-ad3dd2776076)

![ภาพ](https://github.com/user-attachments/assets/4d9a7fe5-b145-4c1a-b240-2318cd7cd28f)

![ภาพ](https://github.com/user-attachments/assets/0e9c23a9-0370-43db-9d10-154b9e98ed17)

![ภาพ](https://github.com/user-attachments/assets/7d912f7c-fbd7-4585-a87b-79360d12fb1c)


![ภาพ](https://github.com/user-attachments/assets/9ec74747-0d70-4472-9612-044698dfac82)

![ภาพ](https://github.com/user-attachments/assets/c322e998-9989-465b-8c65-2818b358b79a)

![ภาพ](https://github.com/user-attachments/assets/5a1a38b3-5295-48f4-9a74-31794aa415e1)

![ภาพ](https://github.com/user-attachments/assets/db1790d3-7c0b-47a3-a22c-283999ed09c4)







https://youtu.be/Gu9txMng_nQ?si=OM6L8B3bs_LTpoz5


